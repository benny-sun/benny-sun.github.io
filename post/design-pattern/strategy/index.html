<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Strategy pattern | 班尼の筆記</title><meta name=keywords content="design pattern"><meta name=description content="概念 像是選擇不同交通方式上班， 把影響選擇的因素(例如: 天候、預算、身體狀況、緊急程度等)和選擇帶來的後果(例如: 路線、耗時、花費等)拆分開來管理。
圖片來源: https://refactoring.guru/design-patterns/strategy  這篇來自讀過 Design Patterns Explained: A New Perspective on Object Oriented Design, 2nd Edition 一書中 The Strategy Pattern 章節的重點整理。
作者提出一系列面對新需求的應對方式使系統程式碼更具彈性，在面對未來的變化能更從容、更易擴充和維護。
 處理新需求之案例研究 書中以一個在美國的國際電商為實務案例來說明在面對新需求的思考和處理方式。
訂單處理系統之系統架構 TaskController
 處理銷售請求 決定何時將請求交給 SalesOrder 來處理訂單  SalesOrder
 透過 GUI 填寫訂單 處理稅額計算 <&ndash; 本章討論案例 列印收據    新需求：支援加拿大的稅額計算
 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  // Handle Tax switch (myNation) { case US: // US Tax rules here break;  case Canada: // Canadian Tax rules here break; } // Handle Currency switch (myNation) { case US: // US Currency rules here break;  case Canada: // Canadian Currency rules here break; } // Handle Date Format switch (myNation) { case US: // use mm/dd/yy format break;  case Canada: // use dd/mm/yy format break; }     新需求：支援德國的稅額計算＆多國語系"><meta name=author content="Theme PaperMod"><link rel=canonical href=https://benny-sun.github.io/post/design-pattern/strategy/><link crossorigin=anonymous href=/assets/css/stylesheet.min.ec8da366ca2fb647537ccb7a8f6fa5b4e9cd3c7a0d3171dd2d3baad1e49c8bfc.css integrity="sha256-7I2jZsovtkdTfMt6j2+ltOnNPHoNMXHdLTuq0eSci/w=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://benny-sun.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://benny-sun.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://benny-sun.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://benny-sun.github.io/apple-touch-icon.png><link rel=mask-icon href=https://benny-sun.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Strategy pattern"><meta property="og:description" content="概念 像是選擇不同交通方式上班， 把影響選擇的因素(例如: 天候、預算、身體狀況、緊急程度等)和選擇帶來的後果(例如: 路線、耗時、花費等)拆分開來管理。
圖片來源: https://refactoring.guru/design-patterns/strategy  這篇來自讀過 Design Patterns Explained: A New Perspective on Object Oriented Design, 2nd Edition 一書中 The Strategy Pattern 章節的重點整理。
作者提出一系列面對新需求的應對方式使系統程式碼更具彈性，在面對未來的變化能更從容、更易擴充和維護。
 處理新需求之案例研究 書中以一個在美國的國際電商為實務案例來說明在面對新需求的思考和處理方式。
訂單處理系統之系統架構 TaskController
 處理銷售請求 決定何時將請求交給 SalesOrder 來處理訂單  SalesOrder
 透過 GUI 填寫訂單 處理稅額計算 <&ndash; 本章討論案例 列印收據    新需求：支援加拿大的稅額計算
 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  // Handle Tax switch (myNation) { case US: // US Tax rules here break;  case Canada: // Canadian Tax rules here break; } // Handle Currency switch (myNation) { case US: // US Currency rules here break;  case Canada: // Canadian Currency rules here break; } // Handle Date Format switch (myNation) { case US: // use mm/dd/yy format break;  case Canada: // use dd/mm/yy format break; }     新需求：支援德國的稅額計算＆多國語系"><meta property="og:type" content="article"><meta property="og:url" content="https://benny-sun.github.io/post/design-pattern/strategy/"><meta property="og:image" content="https://benny-sun.github.io/papermod-cover.png"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-06-12T13:28:28+08:00"><meta property="article:modified_time" content="2022-06-12T13:28:28+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://benny-sun.github.io/papermod-cover.png"><meta name=twitter:title content="Strategy pattern"><meta name=twitter:description content="概念 像是選擇不同交通方式上班， 把影響選擇的因素(例如: 天候、預算、身體狀況、緊急程度等)和選擇帶來的後果(例如: 路線、耗時、花費等)拆分開來管理。
圖片來源: https://refactoring.guru/design-patterns/strategy  這篇來自讀過 Design Patterns Explained: A New Perspective on Object Oriented Design, 2nd Edition 一書中 The Strategy Pattern 章節的重點整理。
作者提出一系列面對新需求的應對方式使系統程式碼更具彈性，在面對未來的變化能更從容、更易擴充和維護。
 處理新需求之案例研究 書中以一個在美國的國際電商為實務案例來說明在面對新需求的思考和處理方式。
訂單處理系統之系統架構 TaskController
 處理銷售請求 決定何時將請求交給 SalesOrder 來處理訂單  SalesOrder
 透過 GUI 填寫訂單 處理稅額計算 <&ndash; 本章討論案例 列印收據    新需求：支援加拿大的稅額計算
 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  // Handle Tax switch (myNation) { case US: // US Tax rules here break;  case Canada: // Canadian Tax rules here break; } // Handle Currency switch (myNation) { case US: // US Currency rules here break;  case Canada: // Canadian Currency rules here break; } // Handle Date Format switch (myNation) { case US: // use mm/dd/yy format break;  case Canada: // use dd/mm/yy format break; }     新需求：支援德國的稅額計算＆多國語系"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://benny-sun.github.io/post/"},{"@type":"ListItem","position":2,"name":"Strategy pattern","item":"https://benny-sun.github.io/post/design-pattern/strategy/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Strategy pattern","name":"Strategy pattern","description":"概念 像是選擇不同交通方式上班， 把影響選擇的因素(例如: 天候、預算、身體狀況、緊急程度等)和選擇帶來的後果(例如: 路線、耗時、花費等)拆分開來管理。\n圖片來源: https://refactoring.guru/design-patterns/strategy  這篇來自讀過 Design Patterns Explained: A New Perspective on Object Oriented Design, 2nd Edition 一書中 The Strategy Pattern 章節的重點整理。\n作者提出一系列面對新需求的應對方式使系統程式碼更具彈性，在面對未來的變化能更從容、更易擴充和維護。\n 處理新需求之案例研究 書中以一個在美國的國際電商為實務案例來說明在面對新需求的思考和處理方式。\n訂單處理系統之系統架構 TaskController\n 處理銷售請求 決定何時將請求交給 SalesOrder 來處理訂單  SalesOrder\n 透過 GUI 填寫訂單 處理稅額計算 \u0026lt;\u0026ndash; 本章討論案例 列印收據    新需求：支援加拿大的稅額計算\n 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  // Handle Tax switch (myNation) { case US: // US Tax rules here break;  case Canada: // Canadian Tax rules here break; } // Handle Currency switch (myNation) { case US: // US Currency rules here break;  case Canada: // Canadian Currency rules here break; } // Handle Date Format switch (myNation) { case US: // use mm/dd/yy format break;  case Canada: // use dd/mm/yy format break; }     新需求：支援德國的稅額計算＆多國語系","keywords":["design pattern"],"articleBody":"概念 像是選擇不同交通方式上班， 把影響選擇的因素(例如: 天候、預算、身體狀況、緊急程度等)和選擇帶來的後果(例如: 路線、耗時、花費等)拆分開來管理。\n圖片來源: https://refactoring.guru/design-patterns/strategy  這篇來自讀過 Design Patterns Explained: A New Perspective on Object Oriented Design, 2nd Edition 一書中 The Strategy Pattern 章節的重點整理。\n作者提出一系列面對新需求的應對方式使系統程式碼更具彈性，在面對未來的變化能更從容、更易擴充和維護。\n 處理新需求之案例研究 書中以一個在美國的國際電商為實務案例來說明在面對新需求的思考和處理方式。\n訂單處理系統之系統架構 TaskController\n 處理銷售請求 決定何時將請求交給 SalesOrder 來處理訂單  SalesOrder\n 透過 GUI 填寫訂單 處理稅額計算 列印收據    新需求：支援加拿大的稅額計算\n 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  // Handle Tax switch (myNation) { case US: // US Tax rules here break;  case Canada: // Canadian Tax rules here break; } // Handle Currency switch (myNation) { case US: // US Currency rules here break;  case Canada: // Canadian Currency rules here break; } // Handle Date Format switch (myNation) { case US: // use mm/dd/yy format break;  case Canada: // use dd/mm/yy format break; }     新需求：支援德國的稅額計算＆多國語系\n 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37  // Handle Tax switch (myNation) { case US: // US Tax rules here break;  case Canada: // Canadian Tax rules here break;  case Germany: // Germany Tax rules here break; } // Handle Currency switch (myNation) { case US: // US Currency rules here break;  case Canada: // Canadian Currency rules here break;  case Germany: // Euro Currency rules here break; } // Handle Date Format switch (myNation) { case US: // use mm/dd/yy format break;  case Canada: case Germany: // use dd/mm/yy format break; } // Handle Language switch (myNation) { case US: case Canada: // use English break;  case Germany: // use German break; }     新需求：支援加拿大魁北克的法語\n 1 2 3 4 5 6 7 8 9 10 11  // Handle Language switch (myNation) { case Canada: if (inQuebec) { // use French break;  } case US: // use English break;  case Germany: // use German break; }    以上作法開發中不少見，很直覺新增條件式來應付需求變化\n隨著時間過去，條件式可能因為需求的堆疊而產生多種組合像棵樹一樣蔓延\n這些條件全都集中在 SalesOrder 裡，程式碼會越來越難以維護\n作者也把這種現象稱作 switch creep\n 這時熟悉物件導向特性的開發者可能會想，如果改用繼承來小幅度修改呢？\n沒錯，接下來介紹透過物件導向“直接繼承”的方式來處理新需求\n揭露了另一種混沌的開端\n  直接繼承並覆寫特定方法\n 讓加拿大訂單和德國訂單繼承美國訂單，並 override 稅額計算方法\n效果看起來還不錯，將不同國家的稅額計算規則獨立封裝起來，互不干擾\n但這種類別直接繼承的擴充方式容易產生過多的類別\n例如：未來要支援“免運訂單”、“員購訂單”的稅額計算，則類別數會快速增加\n光是支援兩個國家的稅額計算就需要增加這麼多類別\n而且別忘了 SalesOrder 除了稅額計算還有另外兩個功能，這兩個功能未來如果有其他多型分支，類別數勢必爆炸式增長！\n上述這樣的現象也稱作「組合爆炸(Combinatorial explosion)」\n 組合爆炸原因是類別的責任未妥善劃分\n 當每個類別擁有太多責任時 當每個責任需要多型分支時    這樣的情境就很適合本篇主角 Strategy pattern 登場啦！\n The Strategy Pattern  Find what varies and encapsulate it.\n找出變化並封裝之。\n 先將“稅額計算概念”從 SalesOrder 抽離，並抽象化成 abstract class\n再將每個國家的稅額計算細節各自封裝到 concreate class (USTax, CanTax)\n也就是說，未來出現稅額計算相關的需求變動，SalesOrder 不用更改程式碼，只需要新增稅額計算類別就可以完成，這也符合了 SOLID 原則中的 OCP 開放封閉原則\n  Use aggregation instead of inheritance.\n使用聚合代替繼承。\n 由 TaskController 選擇具體稅額計算物件(USTax, CanTax)\n將具體稅額計算的 物件參照(reference) 傳遞給 SalesOrder\nSalesOrder 透過抽象稅額計算(CalcTax) 參照到具體稅額計算物件，並執行具體稅額計算物件，而且並不會知道具體執行了哪個物件\n 定義  Define a family of algorithms, encapsulate each one, and make them interchangeable. Strategy lets the algorithm vary independently from clients that use it. — Gamma, et al\n 通用結構圖 References  https://refactoring.guru/design-patterns/strategy https://www.youtube.com/watch?v=IkG_KuMpQRM  ","wordCount":"426","inLanguage":"en","datePublished":"2022-06-12T13:28:28+08:00","dateModified":"2022-06-12T13:28:28+08:00","author":{"@type":"Person","name":"Theme PaperMod"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://benny-sun.github.io/post/design-pattern/strategy/"},"publisher":{"@type":"Organization","name":"班尼の筆記","logo":{"@type":"ImageObject","url":"https://benny-sun.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://benny-sun.github.io/ accesskey=h title="班尼の筆記 (Alt + H)">班尼の筆記</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://benny-sun.github.io/archives title=Archive><span>Archive</span></a></li><li><a href=https://benny-sun.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://benny-sun.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://benny-sun.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://benny-sun.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://benny-sun.github.io/post/>Posts</a></div><h1 class=post-title>Strategy pattern</h1><div class=post-meta><span title="2022-06-12 13:28:28 +0800 +0800">June 12, 2022</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Theme PaperMod&nbsp;|&nbsp;<a href=https://github.com/adityatelange/hugo-PaperMod/tree/exampleSite/content/post/design-pattern/strategy/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e6%a6%82%e5%bf%b5 aria-label=概念>概念</a></li><li><a href=#%e8%99%95%e7%90%86%e6%96%b0%e9%9c%80%e6%b1%82%e4%b9%8b%e6%a1%88%e4%be%8b%e7%a0%94%e7%a9%b6 aria-label=處理新需求之案例研究>處理新需求之案例研究</a><ul><li><a href=#%e8%a8%82%e5%96%ae%e8%99%95%e7%90%86%e7%b3%bb%e7%b5%b1%e4%b9%8b%e7%b3%bb%e7%b5%b1%e6%9e%b6%e6%a7%8b aria-label=訂單處理系統之系統架構>訂單處理系統之系統架構</a></li></ul></li><li><a href=#the-strategy-pattern aria-label="The Strategy Pattern">The Strategy Pattern</a><ul><li><a href=#%e5%ae%9a%e7%be%a9 aria-label=定義>定義</a></li><li><a href=#%e9%80%9a%e7%94%a8%e7%b5%90%e6%a7%8b%e5%9c%96 aria-label=通用結構圖>通用結構圖</a></li></ul></li><li><a href=#references aria-label=References>References</a></li></ul></div></details></div><div class=post-content><h2 id=概念>概念<a hidden class=anchor aria-hidden=true href=#概念>#</a></h2><p>像是選擇不同交通方式上班，
把<strong>影響選擇的因素</strong>(例如: 天候、預算、身體狀況、緊急程度等)和<strong>選擇帶來的後果</strong>(例如: 路線、耗時、花費等)拆分開來管理。</p><p><img loading=lazy src=https://refactoring.guru/images/patterns/content/strategy/strategy-comic-1-en-2x.png alt=image></p><div style=text-align:right><sub><sup>圖片來源: https://refactoring.guru/design-patterns/strategy</sup></sub></div><hr><p>這篇來自讀過 <em>Design Patterns Explained: A New Perspective on Object Oriented Design, 2nd Edition</em> 一書中 <em>The Strategy Pattern</em> 章節的重點整理。</p><p>作者提出一系列面對新需求的應對方式使系統程式碼更具彈性，在面對未來的變化能更從容、更易擴充和維護。</p><hr><h2 id=處理新需求之案例研究>處理新需求之案例研究<a hidden class=anchor aria-hidden=true href=#處理新需求之案例研究>#</a></h2><p>書中以一個在美國的國際電商為實務案例來說明在面對新需求的思考和處理方式。</p><h3 id=訂單處理系統之系統架構>訂單處理系統之系統架構<a hidden class=anchor aria-hidden=true href=#訂單處理系統之系統架構>#</a></h3><p><img loading=lazy src=images/ch9%e7%b3%bb%e7%b5%b1%e6%9e%b6%e6%a7%8b%e5%9c%96.png alt=image></p><p><strong>TaskController</strong></p><ul><li>處理銷售請求</li><li>決定何時將請求交給 SalesOrder 來處理訂單</li></ul><p><strong>SalesOrder</strong></p><ul><li>透過 GUI 填寫訂單</li><li><strong>處理稅額計算</strong> &lt;&ndash; 本章討論案例</li><li>列印收據</li></ul><hr><blockquote><p>新需求：支援加拿大的稅額計算</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Handle Tax
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>switch</span> <span class=o>(</span><span class=n>myNation</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>US</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// US Tax rules here break;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>case</span> <span class=n>Canada</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Canadian Tax rules here break;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Handle Currency
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>switch</span> <span class=o>(</span><span class=n>myNation</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>US</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// US Currency rules here break;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>case</span> <span class=n>Canada</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Canadian Currency rules here break;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Handle Date Format
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>switch</span> <span class=o>(</span><span class=n>myNation</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>US</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// use mm/dd/yy format break;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>case</span> <span class=n>Canada</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// use dd/mm/yy format break;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><blockquote><p>新需求：支援德國的稅額計算＆多國語系</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Handle Tax
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>switch</span> <span class=o>(</span><span class=n>myNation</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>US</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// US Tax rules here break;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>case</span> <span class=n>Canada</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Canadian Tax rules here break;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>case</span> <span class=n>Germany</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Germany Tax rules here break;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Handle Currency
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>switch</span> <span class=o>(</span><span class=n>myNation</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>US</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// US Currency rules here break;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>case</span> <span class=n>Canada</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Canadian Currency rules here break;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>case</span> <span class=n>Germany</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Euro Currency rules here break;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Handle Date Format
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>switch</span> <span class=o>(</span><span class=n>myNation</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>US</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// use mm/dd/yy format break;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>case</span> <span class=n>Canada</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>Germany</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// use dd/mm/yy format break;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Handle Language
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>switch</span> <span class=o>(</span><span class=n>myNation</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>US</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>Canada</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// use English break;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>case</span> <span class=n>Germany</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// use German break;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><blockquote><p>新需求：支援加拿大魁北克的法語</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Handle Language
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>switch</span> <span class=o>(</span><span class=n>myNation</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>Canada</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>inQuebec</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// use French break;
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>US</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// use English break;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>case</span> <span class=n>Germany</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// use German break;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><p>以上作法開發中不少見，很直覺新增條件式來應付需求變化</p><p>隨著時間過去，條件式可能因為需求的堆疊而產生多種組合像棵樹一樣蔓延</p><p>這些條件全都集中在 SalesOrder 裡，程式碼會越來越難以維護</p><p>作者也把這種現象稱作 <strong>switch creep</strong></p><hr><p>這時熟悉物件導向特性的開發者可能會想，如果改用繼承來小幅度修改呢？</p><p>沒錯，接下來介紹透過物件導向“直接繼承”的方式來處理新需求</p><p>揭露了另一種混沌的開端</p><hr><blockquote><p>直接繼承並覆寫特定方法</p></blockquote><p><img loading=lazy src=https://s3.amazonaws.com/media-p.slid.es/uploads/1455570/images/9528106/strategy-add_german.drawio.svg alt=image></p><p>讓加拿大訂單和德國訂單繼承美國訂單，並 override 稅額計算方法</p><p>效果看起來還不錯，將不同國家的稅額計算規則獨立封裝起來，互不干擾</p><p>但這種類別直接繼承的擴充方式容易產生過多的類別</p><p>例如：未來要支援“免運訂單”、“員購訂單”的稅額計算，則類別數會快速增加</p><p><img loading=lazy src=images/strategy_%e6%a1%88%e4%be%8b%e7%a0%94%e7%a9%b6_explosion.svg alt=image></p><p>光是支援兩個國家的稅額計算就需要增加這麼多類別</p><p>而且別忘了 SalesOrder 除了稅額計算還有另外兩個功能，這兩個功能未來如果有其他多型分支，類別數勢必爆炸式增長！</p><p>上述這樣的現象也稱作「組合爆炸(Combinatorial explosion)」</p><blockquote><p>組合爆炸原因是類別的責任未妥善劃分</p><ol><li>當每個類別擁有太多責任時</li><li>當每個責任需要多型分支時</li></ol></blockquote><hr><p>這樣的情境就很適合本篇主角 Strategy pattern 登場啦！</p><hr><h2 id=the-strategy-pattern>The Strategy Pattern<a hidden class=anchor aria-hidden=true href=#the-strategy-pattern>#</a></h2><blockquote><p>Find what varies and encapsulate it.</p><p>找出變化並封裝之。</p></blockquote><p><img loading=lazy src=images/strategy_%e5%a5%97%e7%94%a8%e6%a8%a1%e5%bc%8f-%e5%b0%81%e8%a3%9d%e8%ae%8a%e5%8c%96.svg alt=image></p><p>先將“稅額計算概念”從 SalesOrder 抽離，並抽象化成 abstract class</p><p>再將每個國家的稅額計算細節各自封裝到 concreate class (USTax, CanTax)</p><p>也就是說，未來出現稅額計算相關的需求變動，SalesOrder 不用更改程式碼，只需要新增稅額計算類別就可以完成，這也符合了 SOLID 原則中的 OCP 開放封閉原則</p><hr><blockquote><p>Use aggregation instead of inheritance.</p><p>使用聚合代替繼承。</p></blockquote><p><img loading=lazy src=images/strategy_%e5%a5%97%e7%94%a8%e6%a8%a1%e5%bc%8f_%e4%bd%bf%e7%94%a8%e8%81%9a%e5%90%88.svg alt=image></p><p>由 TaskController 選擇<strong>具體稅額計算物件(USTax, CanTax)</strong></p><p>將具體稅額計算的 <strong>物件參照(reference)</strong> 傳遞給 SalesOrder</p><p>SalesOrder <strong>透過抽象稅額計算(CalcTax) 參照到具體稅額計算物件</strong>，並執行具體稅額計算物件，而且並<strong>不會知道</strong>具體執行了哪個物件</p><hr><h3 id=定義>定義<a hidden class=anchor aria-hidden=true href=#定義>#</a></h3><blockquote><p>Define a family of algorithms, encapsulate each one, and make them interchangeable. Strategy lets the algorithm vary independently from clients that use it. &mdash; Gamma, et al</p></blockquote><h3 id=通用結構圖>通用結構圖<a hidden class=anchor aria-hidden=true href=#通用結構圖>#</a></h3><p><img loading=lazy src=https://s3.amazonaws.com/media-p.slid.es/uploads/1455570/images/9528164/pasted-from-clipboard.png alt=image></p><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><ul><li><a href=https://refactoring.guru/design-patterns/strategy>https://refactoring.guru/design-patterns/strategy</a></li><li><a href="https://www.youtube.com/watch?v=IkG_KuMpQRM">https://www.youtube.com/watch?v=IkG_KuMpQRM</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://benny-sun.github.io/tags/design-pattern/>design pattern</a></li></ul><nav class=paginav><a class=next href=https://benny-sun.github.io/post/2020/merge-sort/><span class=title>Next »</span><br><span>Merge Sort</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://benny-sun.github.io/>班尼の筆記</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerHTML="copy";function s(){e.innerHTML="copied!",setTimeout(()=>{e.innerHTML="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>